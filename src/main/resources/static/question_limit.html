<!DOCTYPE html>
<html>
<head>
    <title>Question Limit</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div style="text-align: right; padding: 10px; background: #252525; margin-bottom: 20px;">
        <a href="admin-dashboard.html" style="color: #aaa; margin-right: 15px; text-decoration: none;">‚Üê Back to Dashboard</a>
        <button onclick="Auth.logout()" style="padding: 8px 16px; background: #444; color: white; border: none; border-radius: 4px; cursor: pointer;">Logout</button>
    </div>
    <h1>Set Question Limit</h1>
    <form id="setLimitForm">
        <input name="limit" type="number" placeholder="Question Limit" required>
        <button type="submit">Set Limit</button>
    </form>
        <form id="updateQuestionLimitForm">
            <input name="limit" placeholder="Question Limit" required>
            <button type="submit">Update Limit</button>
        </form>
        <div id="questionLimitMsg" style="color:red;margin-top:10px;"></div>
    <hr>
    <button onclick="getLimit()">Get Current Limit</button>
    <div id="currentLimit"></div>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        Auth.requireAuth('ADMIN');
        // Set question limit
        document.getElementById('setLimitForm').onsubmit = async function(e) {
            e.preventDefault();
            const form = e.target;
            const body = { limit: parseInt(form.limit.value) };
            await apiFetch('/api/admin/question-limit', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });
            getLimit();
        };
            // Update question limit
            document.getElementById('updateQuestionLimitForm').onsubmit = async function(e) {
                e.preventDefault();
                const form = e.target;
                const msgDiv = document.getElementById('questionLimitMsg');
                msgDiv.style.color = 'red';
                msgDiv.textContent = '';
                // Frontend validation
                if (isNaN(parseInt(form.limit.value)) || parseInt(form.limit.value) < 1) {
                    msgDiv.textContent = 'Limit must be a positive number.';
                    return;
                }
                // Add more field checks as needed
                const body = {
                    limit: form.limit.value
                };
                try {
                    const res = await apiFetch('/api/question-limit', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(body)
                    });
                    let data;
                    try { data = await res.json(); } catch { data = {}; }
                    if (res.ok) {
                        msgDiv.style.color = 'green';
                        msgDiv.textContent = data.message || 'Question limit updated successfully.';
                        getQuestionLimit();
                    } else {
                        msgDiv.textContent = data.error || data.message || 'Update question limit failed.';
                    }
                } catch (err) {
                    msgDiv.textContent = 'Network error.';
                }
            };
        // Get current limit
        async function getLimit() {
            const res = await apiFetch('/api/admin/question-limit');
            const limit = await res.json();
            document.getElementById('currentLimit').textContent = `Current Limit: ${limit}`;
        }
    </script>
</body>
</html>
