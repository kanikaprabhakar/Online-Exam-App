<!DOCTYPE html>
<html>
<head>
    <title>Exam Attempts</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Exam Attempts</h1>
    <form id="addExamAttemptForm">
        <input name="studentEmail" placeholder="Student Email" required>
        <input name="score" placeholder="Score" type="number" required>
        <input name="totalQuestions" placeholder="Total Questions" type="number" required>
        <input name="attemptTime" placeholder="Attempt Time (YYYY-MM-DDTHH:MM:SSZ)" required>
        <button type="submit">Add Exam Attempt</button>
    </form>
    <div id="examAttemptMsg" style="color:red;margin-top:10px;"></div>
    <hr>
    <button onclick="getExamAttempts()">Get All Exam Attempts</button>
    <ul id="attemptsList"></ul>
    <script>
        // Add exam attempt
        document.getElementById('addExamAttemptForm').onsubmit = async function(e) {
            e.preventDefault();
            const form = e.target;
            const msgDiv = document.getElementById('examAttemptMsg');
            msgDiv.style.color = 'red';
            msgDiv.textContent = '';
            // Frontend validation
            if (!form.studentEmail.value || !form.studentEmail.value.includes('@')) {
                msgDiv.textContent = 'Student Email must be valid.';
                return;
            }
            if (isNaN(parseInt(form.score.value)) || parseInt(form.score.value) < 0) {
                msgDiv.textContent = 'Score must be a non-negative number.';
                return;
            }
            if (isNaN(parseInt(form.totalQuestions.value)) || parseInt(form.totalQuestions.value) < 1) {
                msgDiv.textContent = 'Total Questions must be at least 1.';
                return;
            }
            if (!form.attemptTime.value) {
                msgDiv.textContent = 'Attempt Time is required.';
                return;
            }
            // Add more field checks as needed
            const body = {
                studentEmail: form.studentEmail.value,
                score: parseInt(form.score.value),
                totalQuestions: parseInt(form.totalQuestions.value),
                attemptTime: form.attemptTime.value
            };
            try {
                const res = await fetch('/exam-attempts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(body)
                });
                let data;
                try { data = await res.json(); } catch { data = {}; }
                if (res.ok) {
                    msgDiv.style.color = 'green';
                    msgDiv.textContent = data.message || 'Exam attempt added successfully.';
                    getExamAttempts();
                } else {
                    msgDiv.textContent = data.error || data.message || 'Add exam attempt failed.';
                }
            } catch (err) {
                msgDiv.textContent = 'Network error.';
            }
        };
        // Get all exam attempts
        async function getExamAttempts() {
            const res = await fetch('/exam-attempts');
            const attempts = await res.json();
            const ul = document.getElementById('attemptsList');
            ul.innerHTML = '';
            attempts.forEach(a => {
                const li = document.createElement('li');
                li.textContent = `${a.studentEmail} - Score: ${a.score}/${a.totalQuestions} at ${a.attemptTime}`;
                ul.appendChild(li);
            });
        }
    </script>
</body>
</html>
